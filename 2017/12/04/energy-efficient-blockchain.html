
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Energy-efficient blockchain via serendipitous difficulty adjustment - sitr.us</title>
  <meta name="author" content="Jesse Hallett">

  
  <meta name="description" content="Bitcoin has a problem: its mining network uses a lot of energy.
It is estimated that
the mining network consumes 29.05TWh per year
which is more than &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- OpenID delegation -->
  <link rel="openid.delegate" href="http://sitr.us/" />
  <link rel="openid.server" href="https://indieauth.com/openid" />

  
  <link rel="canonical" href="http://sitr.us/2017/12/04/energy-efficient-blockchain.html">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/hallettj" rel="alternate" title="sitr.us" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-327628-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">sitr.us</a></h1>
  
    <h2>posts by Jesse Hallett</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/hallettj" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sitr.us" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Energy-efficient blockchain via serendipitous difficulty adjustment</h1>
    
    
      <p class="meta">
        








  
  



<time datetime="2017-12-04" pubdate data-updated="true">2017-12-04</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Bitcoin has a problem: its mining network uses a lot of energy.
It is estimated that
<a href="https://powercompare.co.uk/bitcoin/">the mining network consumes 29.05TWh per year</a>
which is more than the total consumption of the Republic of Ireland.<sup id="fnref:energy-units"><a href="#fn:energy-units" rel="footnote">1</a></sup>
Cost of electricity is the limiting factor in mining profit;
so as the <a href="https://blockchain.info/charts/market-price">value of BTC</a> increases, energy consumption is likely to follow.
This document presents a possible plan for a blockchain that is like Bitcoin,
Ethereum, etc. -
but with an incentive structure designed to reduce energy use.</p>

<p>Every hash computed by any miner has an equal probability of being the one that
solves a block and earns revenue.
So every miner is incentivized to compute as many hashes as their budget allows
at all times.
The incentive structure changes if a small, random selection of miners are
granted a lower <a href="TODO">difficulty</a> for a given block solution
(serendipitous difficulty adjustment).
Each hash generated by those miners is more likely to solve the block.
If the reduction in difficulty is large enough then other miners are
incentivized to avoid computing hashes until they are lucky enough to get
reduced difficulty for some future block.</p>

<p>A hash is just a large number.
Hashes of blocks and hashes of public keys fall on one long number line;
so any two hashes are separated by a measurable distance.<sup id="fnref:distance"><a href="#fn:distance" rel="footnote">2</a></sup>
A miner chooses the public key that they will use as a payout address in their
attempted solutions for the next block.
The difficulty for the solution for the next block can be adjusted according to
a function so that a small distance between the hash of the miner’s payout
address and the hash of the hash of the last solved block results in a low
difficulty for that miner.<sup id="fnref:double-hash"><a href="#fn:double-hash" rel="footnote">3</a></sup>
If the adjustment function has a steep curve then a small portion of miners who
are especially “close” to the hash of the last block are granted much lower
difficulty for the block compared to the rest of the mining network.
If balanced correctly this encourages rational actors to use less energy.
More on that in a bit.</p>

<p>TODO: levelling the playing field</p>

<h2 id="managing-incentive-to-compute-public-keys">Managing incentive to compute public keys</h2>

<p>There is a problem:
serendipitous difficulty adjustment by itself shifts incentive from computing
block hashes to computing public keys.
Owning a lot of public keys increases the chance that a miner will posses a key
that is close to the last solved block.
The solution has two parts:
require that a payout address have an existing balance over some minimum
threshold to qualify for difficulty reduction;
and either increase block revenue to high-value accounts,
or introduce a cost to splitting assets into low-value accounts.
One option could be to cap the payout from a block proportionally to the value
in the account associated with the payout address.
But an elegant solution is available if the blockchain implementation includes
demurrage.</p>

<p>In the context of a cryptocurrency demurrage is a steady rate of decrease in
the quantity of currency units (CU) in every account -
let’s say 3% per year amortized per block.
So if you put 100 CU into an account and left it then a year later the account
would hold about 97 CU.
It might seem ridiculous to ask people to use a currency that spontaneously
evaporates;
but according to a
<a href="TODO">theory pioneered by economist Silvio Gesell</a>
a demurrage rate of 3-5% per year leads to stable currency value, encourages
spending, and encourages low-interest loans.
The common economic criticism of Bitcoin is that it is deflationary,
which leads to unstable value, discourages spending, and discourages lending.
The possibility of solving those problems makes demurrage worth considering on
its own merit.
Demurrage has already been implemented in at least on cryptocurrency,
<a href="http://freico.in/">Freicoin</a>.<sup id="fnref:Freicoin-Foundation"><a href="#fn:Freicoin-Foundation" rel="footnote">4</a></sup></p>

<p>Instead of a flat rate demurrage can be made variable so that the rate
increases slightly with lower account values.
With the right tuning a small increase in the demurrage rate can offset the
advantage of owning more payout addresses to be able to solve more blocks.
That eliminates the incentive for miners to spend energy to generate public
keys.<sup id="fnref:rich-get-richer"><a href="#fn:rich-get-richer" rel="footnote">5</a></sup></p>

<p>An account with a balance very close to zero should have the maximum demurrage
rate,
and the rate charged for an account should asymptotically approach some
non-negative base rate as the account balance increases.
In this equation the choice of the constant <script type="math/tex">c</script> determines the difference
between the base rate and the maximum rate:</p>

<script type="math/tex; mode=display">
demurrage(balance) = \frac{balance + c}{\left( balance + c \right) ^2 + c^2} + baseRate
</script>

<p>Using the values <script type="math/tex">baseRate =</script> 3% and <script type="math/tex">c =</script> 100 gives a maximum demurrage
rate of 3.5%.</p>

<p>The constraints that determine the minimum increase in demurrage to offset
returns from spreading currency over multiple accounts are expressed by the
following equations.
The goal of this document is to introduce an idea,
not to exhaustively study the feasibility of the idea;
so there are some simplifying assumptions here -
including an assumption that serendipitous difficulty reduction outweighs each
miner’s computational capacity so that any account with sufficient balance has
an equal probability of getting the payout from any given solved block.</p>

<script type="math/tex; mode=display">
revenuePerAccount = \frac{averageBlockRevenue}{numCompetingAccounts} \times blocksPerYear
</script>

<script type="math/tex; mode=display">
profit(capital, n) = n \times \left(revenuePerAccount - demurrage\left(\frac{capital}{n}\right) \right)
</script>

<script type="math/tex; mode=display">% <![CDATA[

\forall n, capital. \frac{capital}{n} \geq minBalance \to profit(capital, n) < profit(capital, 1)
 %]]></script>

<p>Every account generates the same expected revenue because in this scheme the
payout from solving a block is independent of the balance in the account that
revenue is paid to.
The only requirement is that an account must have some minimum balance to
qualify for serendipitous difficulty reduction
(given by <script type="math/tex">minBalance</script>).
The variable <script type="math/tex">numCompetingAccounts</script> is the number accounts in the world whose
value meets or exceeds <script type="math/tex">minBalance</script>.
The equation for <script type="math/tex">profit</script> describes the expected revenue from distributing
<script type="math/tex">capital</script> evenly over <script type="math/tex">n</script> accounts
minus demurrage costs from those accounts.</p>

<p>There are three knobs available for tuning this algorithm:
choices of <script type="math/tex">baseRate</script> and <script type="math/tex">c</script> from the equation for <script type="math/tex">demurrage</script>,
and choice of <script type="math/tex">minBalance</script>.
To make the incentive structure work it is necessary to assign values to those
variables that satisfy the given equations.
Plausible values for <script type="math/tex">averageBlockRevenue</script>, <script type="math/tex">blocksPerYear</script>, and
<script type="math/tex">numCompetingAccounts</script> can be obtained by examining Bitcoin statistics.
Data from 2017 show approximately 
<script type="math/tex">averageBlockRevenue =</script> 14.5 BTC<sup id="fnref:averageBlockRevenue"><a href="#fn:averageBlockRevenue" rel="footnote">6</a></sup>
(compared to ~16,700,000 BTC in circulation)<sup id="fnref:BTC-in-circulation"><a href="#fn:BTC-in-circulation" rel="footnote">7</a></sup>
and
<script type="math/tex">blocksPerYear =</script> 52560<sup id="fnref:blocksPerYear"><a href="#fn:blocksPerYear" rel="footnote">8</a></sup>.
A <a href="https://blog.lawnmower.io/the-bitcoin-wealth-distribution-69a92cc4efcc">Bitcoin wealth distribution analyisis from Lawnmower</a>
from 2016 provides values for <script type="math/tex">numCompetingAccounts</script> for various possible
choices of <script type="math/tex">minBalance</script>:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">Minimum balance</th>
      <th style="text-align: right"># Accounts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">0.0001</td>
      <td style="text-align: right">7,400,000</td>
    </tr>
    <tr>
      <td style="text-align: right">0.001</td>
      <td style="text-align: right">4,500,000</td>
    </tr>
    <tr>
      <td style="text-align: right">0.01</td>
      <td style="text-align: right">2,800,000</td>
    </tr>
    <tr>
      <td style="text-align: right">0.1</td>
      <td style="text-align: right">1,200,000</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">446,301</td>
    </tr>
    <tr>
      <td style="text-align: right">10</td>
      <td style="text-align: right">131,709</td>
    </tr>
    <tr>
      <td style="text-align: right">100</td>
      <td style="text-align: right">13,698</td>
    </tr>
    <tr>
      <td style="text-align: right">1000</td>
      <td style="text-align: right">1,658</td>
    </tr>
    <tr>
      <td style="text-align: right">10000</td>
      <td style="text-align: right">121</td>
    </tr>
    <tr>
      <td style="text-align: right">100000</td>
      <td style="text-align: right">1</td>
    </tr>
  </tbody>
</table>

<h2 id="does-this-really-reduce-energy-use">Does this really reduce energy use?</h2>

<p>The result is that at any given time only a few miners are using energy to
compute hashes.
Those miners will be to afford to use more energy to compute more hashes
because they have a higher probability of solving the block than they would
without reduced difficulty,
so the expected return on a hash is higher.
But the expected competition is lower;
at a certain point spending more on energy eats into revenue unnecessarily.</p>

<p>TODO: a miner with a low difficulty could outsource computations to a computing
grid in exchange for a share of the revenue</p>

<p>TODO: how does serendipity affect predictability of rate of block solutions</p>

<h2 id="what-is-the-effect-on-predictability-of-block-solution-rates">What is the effect on predictability of block solution rates?</h2>

<p>TODO: compare to proof-of-stake</p>
<div class="footnotes">
  <ol>
    <li id="fn:energy-units">
      <p>That’s 104.58 PJ per year for those who prefer not to include time units in both the numerator and the denominator of their energy unit.<a href="#fnref:energy-units" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:distance">
      <p>The distance that is measured depends on the chosen distance function. The <a href="http://www.bittorrent.org/beps/bep_0005.html">Kademlia</a> distributed hash table protocol uses XOR because it is fast and satisfies <a href="https://en.wikipedia.org/wiki/Triangle_inequality">triangle inequality</a>. Peers in a Kademlia network use distance measurements between hashes to make decisions about which other peers to connect to.<a href="#fnref:distance" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:double-hash">
      <p>A block solution is a choice of nonce for a block that results in a block hash with a certain number of leading zero bits. So block hashes are biased toward one end of the number line. Using a hash of the block hash to compute difficulty adjustment removes that bias.<a href="#fnref:double-hash" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:Freicoin-Foundation">
      <p>In a demurrage system currency that is paid to demurrage does not disappear - it is redistributed to keep the money supply constant. Freicoin does this by granting that currency to the Freicoin Foundation to distribute to worthy causes. The role of the Foundation is perhaps at odds with the goal of a decentralized cryptocurrency. Another option is to redistribute demurrage via block rewards. In that case combined block rewards over a year would total at least 3% of the total money supply. At the time of this writing the Bitcoin reward is 12.5 BTC per block, which totals 3.9% of the money supply over a year of blocks. So there is precedent for block rewards at that level.<a href="#fnref:Freicoin-Foundation" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:rich-get-richer">
      <p>Increased demurrage for lower-value accounts has an unfortunate effect of penalizing people with less money. It is difficult to find an incentive structure for mining that avoids a rich-get-richer effect. The increase in demurrage should be kept as low as possible.<a href="#fnref:rich-get-richer" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:averageBlockRevenue">
      <p>Average revenue per block based on <a href="https://www.smartbit.com.au/charts/miner-revenue-per-block?from=2016-12-6&amp;to=2017-12-6&amp;day_average=30">data from 2017</a><a href="#fnref:averageBlockRevenue" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:BTC-in-circulation">
      <p>The value given for BTC in circulation is based on <a href="https://www.smartbit.com.au/charts/currency-total?from=2016-12-6&amp;to=2017-12-6">data from 2017</a><a href="#fnref:BTC-in-circulation" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:blocksPerYear">
      <p>Bitcoin is designed to keep the mining rate close to one block every ten minutes, which gives 52560 blocks per year. <a href="https://www.smartbit.com.au/charts/blocks-total?from=2016-12-6&amp;to=2017-12-6">Data from 2017</a> shows that the real value is in that neighborhood.<a href="#fnref:blocksPerYear" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
</div>


  <footer>
    

    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jesse Hallett</span></span>

      








  
  



<time datetime="2017-12-04" pubdate data-updated="true">2017-12-04</time>
      


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2017/06/20/what-is-poodle.html" title="Previous Post: What is Poodle">&laquo; What is Poodle</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2017/12/04/energy-efficient-blockchain.html">Energy-efficient blockchain via serendipitous difficulty adjustment</a>
      </li>
    
      <li class="post">
        <a href="/2017/06/20/what-is-poodle.html">What is Poodle</a>
      </li>
    
      <li class="post">
        <a href="/2017/02/21/changes-i-would-make-to-go.html">Changes I would make to Go</a>
      </li>
    
      <li class="post">
        <a href="/2017/01/03/flow-cookbook-react.html">Flow Cookbook: Flow & React</a>
      </li>
    
      <li class="post">
        <a href="/2016/12/20/flow-cookbook-unpacking-json.html">Flow Cookbook: Unpacking JSON API data</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Talks</h1>
  <ul id="talks">
    <li><a href="http://opensourcebridge.org/sessions/1067">Mod your Android</a></li>
    <li><a href="talks/intro-to-javascript/">Introduction to JavaScript</a></li>
    <li><a href="http://lanyrd.com/2012/nodepdx/smyqm/">Object-oriented patterns in JavaScript</a></li>
    <li><a href="talks/cookies/">Cookies are bad for you</a></li>
    <li><a href="talks/professional-javascript/">Professional JavaScript</a></li>
    <li><a href="http://opensourcebridge.org/2009/wiki/Clustering_Data_--_How_to_Have_Fun_in_n-Dimensions">Cluster Analysis: How to Have Fun in n Dimensions</a></li>
    <li><a href="https://docs.google.com/presentation/d/1hx9Pzo07aAnZ2skMH4JPjH7a6IXx64uC0zRliS3qpkk/edit?usp=sharing">How to build blazing fast web apps with Ruby on Rails</a></li>
  </ul>
</section>
<section>
  <h1>Open Source Projects</h1>
  <ul id="projects">
    <li><a href="http://github.com/jivesoftware/tAMD">tAMD:</a> Tiny, extensible implementation of the Asynchronous Module Definition (AMD) specification from CommonJS</li>
  </ul>
</section>
<section>
  <div class="contact" style="float:left; margin:0.5em;">
    <p>
      Jesse Hallett<br/>
      <a href="mailto:jesse@sitr.us">jesse@sitr.us</a>
    </p>
  </div>
  <div class="contact" style="float:left; margin:0.5em;">
    <p>
      <a rel="me" href="https://github.com/hallettj/">github.com/hallettj</a><br />
      <a rel="me" href="https://twitter.com/hallettj/">twitter.com/hallettj</a>
    </p>
  </div>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Jesse Hallett -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'hallettj';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://sitr.us/2017/12/04/energy-efficient-blockchain.html';
        var disqus_url = 'http://sitr.us/2017/12/04/energy-efficient-blockchain.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
