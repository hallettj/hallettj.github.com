
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Flow Cookbook: Flow & React - sitr.us</title>
  <meta name="author" content="Jesse Hallett">

  
  <meta name="description" content="This recipe is part of the Flow Cookbook series. Flow and React are both Facebook projects -
so as you might imagine, they work quite well together. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- OpenID delegation -->
  <link rel="openid.delegate" href="http://sitr.us/" />
  <link rel="openid.server" href="https://indieauth.com/openid" />

  
  <link rel="canonical" href="http://sitr.us/2017/01/03/flow-cookbook-react.html">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/hallettj" rel="alternate" title="sitr.us" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Ubuntu+Mono:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-327628-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">sitr.us</a></h1>
  
    <h2>posts by Jesse Hallett</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/hallettj" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sitr.us" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Flow Cookbook: Flow & React</h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-01-03T00:00:00-08:00" pubdate data-updated="true">2017-01-03</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><em>This recipe is part of the <a href="/2016/12/20/flow-cookbook.html">Flow Cookbook</a> series.</em></p>

<p>Flow and React are both Facebook projects -
so as you might imagine, they work quite well together.
React components can take type parameters to specify types for props, default
props, and state.
Type-checking works well with both <a href="https://facebook.github.io/react/docs/components-and-props.html#functional-and-class-components">functional and class components</a>.</p>

<p>Flow type annotations provide an alternative to <code>propTypes</code> runtime checks.
Flow’s static checking has some advantages:</p>

<ul>
  <li>Problems are reported immediately - it is not necessary to run tests that
evaluate every component to identify <code>props</code> mismatches.</li>
  <li>Flow types can be more precise and concise than <code>propTypes</code>.</li>
  <li>Flow can also check <code>state</code> as well as <code>props</code>.</li>
  <li>In addition to checking that a component gets the correct <code>props</code>,
Flow checks that <code>props</code> and <code>states</code> are used correctly within the component’s
<code>render</code> method,
and in other component methods.</li>
</ul>

<!-- more -->

<h2 id="how-it-works">How it works</h2>

<p>The form for type parameters on a component class is:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="kr">class</span> <span class="nx">MyComponent</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="o">&lt;</span><span class="nx">DefaultProps</span><span class="p">,</span> <span class="nx">Props</span><span class="p">,</span> <span class="nx">State</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">state</span><span class="o">:</span> <span class="nx">State</span>
</span><span class="line">
</span><span class="line">  <span class="cm">/* ... */</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Where <code>DefaultProps</code>, <code>Props</code>, and <code>State</code> can be whatever object types you
want.
For example, if your component has the props <code>title</code>, <code>createdAt</code>, and
<code>authorId</code> then a definition for <code>Props</code> could look like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="nx">type</span> <span class="nx">Props</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">title</span><span class="o">:</span> <span class="nx">string</span><span class="p">,</span>
</span><span class="line">  <span class="nx">createdAt</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span>
</span><span class="line">  <span class="nx">authorId</span><span class="o">:</span> <span class="nx">number</span><span class="p">,</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>For any type parameter that you don’t want to use,
give the type <code>void</code> instead.
For example, a component that has no internal state gets <code>void</code> for its third
type parameter.</p>

<p>If you use <code>defaultProps</code>, the props type should include types for <em>all</em> props -
even those that have default values.
The type for default props should only provide types for props that have
default values.</p>

<p>Note that the state type needs to be given twice (unless it is <code>void</code>) -
once as the third type parameter, and again as the type of the <code>state</code> instance
variable.</p>

<p>The form for stateless, functional components is:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="kd">function</span> <span class="nx">MyComponent</span><span class="p">(</span><span class="nx">props</span><span class="o">:</span> <span class="nx">Props</span><span class="p">)</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Element</span><span class="o">&lt;*&gt;</span> <span class="p">{</span>
</span><span class="line">  <span class="cm">/* ... */</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Once again, <code>Props</code> can be any object type that you want,
and should include types for all props, even those that have default values.
Notice the return type, <code>React.Element&lt;*&gt;</code>.
Flow uses a type parameter for <code>Element</code> to track internal details,
such as the class and props that produced an element.
You will probably never want to specify that parameter by hand;
so we use <code>*</code>
(Flow’s <a href="/2015/05/31/advanced-features-in-flow.html#existential-types">existential type</a>)
to leave it to Flow to infer the type of that parameter.</p>

<p><a href="https://github.com/facebook/flow/blob/master/lib/react.js">Type definitions for React</a> are built into Flow.
It is useful to look at those definitions to see exactly what Flow expects.
A lot of what I know about using Flow came from examining that file,
and others in the same directory.</p>

<h2 id="a-hacker-news-client">A Hacker News client</h2>

<p>Let’s build on the code from the <a href="/2016/12/20/flow-cookbook-unpacking-json.html">Unpacking JSON API data</a> recipe,
and build a simple Hacker News client.
The client will fetch lists of stories from the Hacker News API to display.
When the user selects a story,
the client will fetch and display comments.</p>

<p>One of the simplest components displays a story as a single line,
and accepts a callback to do something if the user selects that story.
Let’s start be defining a type for the props that this component will accept.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="kr">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Story</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;hacker-news-example&#39;</span>
</span><span class="line">
</span><span class="line"><span class="nx">type</span> <span class="nx">StoryListItemProps</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">story</span><span class="o">:</span> <span class="nx">Story</span><span class="p">,</span>
</span><span class="line">  <span class="nx">onSelect</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">,</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>We import the <code>Story</code> type from <code>'hacker-news-example'</code>,
which is the example code from the <a href="/2016/12/20/flow-cookbook-unpacking-json.html">Unpacking JSON API data</a> recipe.
That <code>Story</code> type is a ready-made type that describes everything we will want
to display in the new client.
Take a look at the <a href="https://github.com/hallettj/hacker-news-example/blob/master/index.js.flow#L9">source file</a> to see what <code>Story</code> looks like.
(The <code>import type</code> syntax is <a href="https://flowtype.org/docs/syntax.html#importing-and-exporting-types">Flow syntax</a> -
it is not part of Javascript.)</p>

<p>The <code>StoryListItemProps</code> type lists the props that will be given to our
component.
The props are a <code>story</code>,
and a callback called <code>onSelect</code>.
The type indicates that <code>onSelect</code> must be a function that takes zero arguments,
and that returns <code>undefined</code> (a.k.a. <code>void</code>).
It is not necessary to require that the return type be <code>undefined</code> -
you could use <code>mixed</code> instead if you do not want to put any constraint on the
callback’s return type.
My opinion is that using <code>void</code> is a clear indication to the caller that the
component will not do anything with a return value.</p>

<p>And here is the <code>StoryListItem</code> component itself:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="kd">function</span> <span class="nx">StoryListItem</span><span class="p">(</span><span class="nx">props</span><span class="o">:</span> <span class="nx">StoryListItemProps</span><span class="p">)</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Element</span><span class="o">&lt;*&gt;</span> <span class="p">{</span>
</span><span class="line">  <span class="kr">const</span> <span class="p">{</span> <span class="nx">by</span><span class="p">,</span> <span class="nx">title</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">story</span>
</span><span class="line">  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class="line">    <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;#&quot;</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">event</span> <span class="o">=&gt;</span> <span class="nx">selectStory</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">event</span><span class="p">)}</span><span class="o">&gt;</span>
</span><span class="line">      <span class="p">{</span><span class="nx">title</span><span class="p">}</span>
</span><span class="line">    <span class="o">&lt;</span><span class="err">/a&gt; posted by {by}</span>
</span><span class="line">  <span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="kd">function</span> <span class="nx">selectStory</span><span class="p">(</span><span class="nx">props</span><span class="o">:</span> <span class="nx">StoryListItemProps</span><span class="p">,</span> <span class="nx">event</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
</span><span class="line">  <span class="nx">props</span><span class="p">.</span><span class="nx">onSelect</span><span class="p">()</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The type annotation, <code>props: StoryListItemProps</code>,
does two things for us:
when <code>StoryListItem</code> is rendered, Flow will check that it is given the required
props of the appropriate types;
and Flow will also check uses of <code>props</code> in the body of the <code>StoryListItem</code>
function for consistency with <code>StoryListItemProps</code>.
Checking props from both directions ensures that a component is in alignment
with its callers.</p>

<p>In general if a component does not have internal state,
and does not use lifecycle callbacks such as <code>componentDidMount</code>,
then I prefer to use a functional component, like <code>StoryListItem</code>.
A functional component cannot have methods that refer to <code>this.props</code>;
so I made the <code>selectStory</code> event handler a top-level function that accepts
a reference to the component’s props as an argument.
Reusing the <code>StoryListItemProps</code> type in the signatures for the component and
for the event handler means that we can easily keep track of available props in
both functions.</p>

<p><code>selectStory</code> also takes an <code>event</code> argument.
The <code>Event</code> type is built into Flow,
and Flow knows about the <code>preventDefault</code> method.
Flow’s take on the <code>Event</code> type is defined in Flow’s
<a href="https://github.com/facebook/flow/blob/master/lib/dom.js#L182">DOM type-definitions file</a>.</p>

<p>To populate instances of the <code>StoryListItem</code> component,
we will need to make API requests and update some state.
Here is a type for that state,
and the parameters for the top-level component, which will manage that state:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="nx">type</span> <span class="nx">AppProps</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">numStories</span><span class="o">:</span> <span class="nx">number</span><span class="p">,</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="nx">type</span> <span class="nx">AppState</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">selectedStory</span><span class="o">?:</span> <span class="o">?</span><span class="nx">Story</span><span class="p">,</span>
</span><span class="line">  <span class="nx">stories</span><span class="o">?:</span> <span class="nx">Story</span><span class="p">[],</span>
</span><span class="line">  <span class="nx">error</span><span class="o">?:</span> <span class="nb">Error</span><span class="p">,</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="kr">class</span> <span class="nx">App</span> <span class="kr">extends</span> <span class="nx">Component</span><span class="o">&lt;</span><span class="k">void</span><span class="p">,</span> <span class="nx">AppProps</span><span class="p">,</span> <span class="nx">AppState</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class="line">  <span class="c1">// Must declare `state` type in two places</span>
</span><span class="line">  <span class="nx">state</span><span class="o">:</span> <span class="nx">AppState</span>
</span><span class="line">
</span><span class="line">  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="o">:</span> <span class="nx">AppProps</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span>
</span><span class="line">    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line">
</span><span class="line">  <span class="cm">/* ... */</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The definition of <code>AppState</code> shows that the state will hold an array of <code>stories</code>,
which will not be defined while stories are loading;
a <code>selectedStory</code>,
which will be defined when the user is viewing comments on a story;
and an <code>error</code>,
in case something goes wrong while loading stories.</p>

<p>Because every property in <code>AppState</code> is optional,
<code>state</code> can be initialized as an empty object.
(The question mark at the end of a property name indicates that property might
not be set.)
<code>selectedStory</code> is optional, and its type is nullable,
so there are two question marks on that line.
That is because <code>selectedStory</code> is initially not set,
and after a user views a story and then backs out to the story list
<code>selectedStory</code> is set to <code>null</code>.</p>

<p>Since <code>App</code> has a <code>constructor</code>,
we specify the props type both in the second class type parameter,
and again in the type of the <code>props</code> argument to <code>constructor</code>.</p>

<p><code>App</code> will fetch stories when it is mounted.
So we extend its definition with a <code>componentDidMount</code> callback.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="kr">import</span> <span class="p">{</span> <span class="nx">fetchTopStories</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;hacker-news-example&#39;</span>
</span><span class="line">
</span><span class="line"><span class="kr">class</span> <span class="nx">App</span> <span class="kr">extends</span> <span class="nx">Component</span><span class="o">&lt;</span><span class="k">void</span><span class="p">,</span> <span class="nx">AppProps</span><span class="p">,</span> <span class="nx">AppState</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class="line">  <span class="cm">/* ... same as before */</span>
</span><span class="line">
</span><span class="line">  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">fetchTopStories</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">numStories</span> <span class="cm">/* number of stories to fetch */</span><span class="p">)</span>
</span><span class="line">      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">stories</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class="line">        <span class="c1">// On success, update component state with an array of stories</span>
</span><span class="line">        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">stories</span> <span class="p">})</span>
</span><span class="line">      <span class="p">})</span>
</span><span class="line">      <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class="line">        <span class="c1">// On error, update state to capture the error for display</span>
</span><span class="line">        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">error</span> <span class="p">})</span>
</span><span class="line">      <span class="p">})</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line">
</span><span class="line">  <span class="cm">/* ... */</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><code>fetchTopStories</code> takes an argument that specifies the number of stories to
fetch,
and it returns a promise.</p>

<p>Once stories are loaded, we can display them via a <code>render</code> method.
But the component will display before those requests are complete -
so we will have to check whether stories have loaded,
and display a loading indicator if they are not ready.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="kr">class</span> <span class="nx">App</span> <span class="kr">extends</span> <span class="nx">Component</span><span class="o">&lt;</span><span class="k">void</span><span class="p">,</span> <span class="nx">AppProps</span><span class="p">,</span> <span class="nx">AppState</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class="line">  <span class="cm">/* ... */</span>
</span><span class="line">
</span><span class="line">  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="kr">const</span> <span class="p">{</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">selectedStory</span><span class="p">,</span> <span class="nx">stories</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span>
</span><span class="line">
</span><span class="line">    <span class="kd">let</span> <span class="nx">content</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="c1">// an error occurred fetching stories</span>
</span><span class="line">      <span class="nx">content</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">selectedStory</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="c1">// the user is looking at comments on a story</span>
</span><span class="line">      <span class="nx">content</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">StoryView</span>
</span><span class="line">        <span class="nx">story</span><span class="o">=</span><span class="p">{</span><span class="nx">selectedStory</span><span class="p">}</span>
</span><span class="line">        <span class="nx">onNavigateBack</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">deselectStory</span><span class="p">()}</span>
</span><span class="line">      <span class="o">/&gt;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">stories</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="c1">// stories are loaded, so display a line item for each story</span>
</span><span class="line">      <span class="nx">content</span> <span class="o">=</span> <span class="nx">stories</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">story</span> <span class="o">=&gt;</span> <span class="p">(</span>
</span><span class="line">        <span class="o">&lt;</span><span class="nx">StoryListItem</span>
</span><span class="line">          <span class="nx">story</span><span class="o">=</span><span class="p">{</span><span class="nx">story</span><span class="p">}</span>
</span><span class="line">          <span class="nx">onSelect</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">selectStory</span><span class="p">(</span><span class="nx">story</span><span class="p">)}</span>
</span><span class="line">          <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">story</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span>
</span><span class="line">        <span class="o">/&gt;</span>
</span><span class="line">      <span class="p">))</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">else</span> <span class="p">{</span>
</span><span class="line">      <span class="c1">// no error and no stories means that stories are still loading</span>
</span><span class="line">      <span class="nx">content</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;loading&quot;</span><span class="o">&gt;</span><span class="nx">loading</span><span class="p">...</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">
</span><span class="line">    <span class="k">return</span> <span class="p">(</span>
</span><span class="line">      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;App&quot;</span><span class="o">&gt;</span>
</span><span class="line">        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;App-header&quot;</span><span class="o">&gt;</span>
</span><span class="line">          <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Flow</span> <span class="nx">Cookbook</span><span class="o">:</span> <span class="nx">React</span> <span class="nx">Example</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
</span><span class="line">        <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class="line">        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span class="line">          <span class="p">{</span><span class="nx">content</span><span class="p">}</span>
</span><span class="line">        <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class="line">      <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line">
</span><span class="line">  <span class="cm">/* ... */</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The import piece of the JSX that is finally returned from <code>render</code> is <code>content</code>,
which is assigned a different value depending on whether an error occurred
while fetching stories,
a specific story has been selected,
or there is an array of stories available, and none has been selected.
If none of those cases applies,
then it means that stories are still loading.</p>

<p>When displaying a list of stories, <code>content</code> is populated by a list of
instances of <code>StoryListItem</code>,
which we defined earlier.
Note that there is nothing special about rendering a type-checked component -
you pass props the same way as with any component.</p>

<p>Flow can track changes to the type of a variable over a series of statements.
Flow infers that when <code>content</code> is first defined its type is <code>void</code>;
and it infers that no matter which code path gets executed,
by the time we get to the <code>return</code> statement the type has changed to either
<code>React.Element&lt;*&gt;</code> or <code>React.Element&lt;*&gt;[]</code>.</p>

<p>The event handling methods <code>selectStory</code> and <code>deselectStory</code> just make simple
state updates:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="kr">class</span> <span class="nx">App</span> <span class="kr">extends</span> <span class="nx">Component</span><span class="o">&lt;</span><span class="k">void</span><span class="p">,</span> <span class="nx">AppProps</span><span class="p">,</span> <span class="nx">AppState</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class="line">  <span class="cm">/* ... */</span>
</span><span class="line">
</span><span class="line">  <span class="nx">selectStory</span><span class="p">(</span><span class="nx">story</span><span class="o">:</span> <span class="nx">Story</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">selectedStory</span><span class="o">:</span> <span class="nx">story</span> <span class="p">})</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line">
</span><span class="line">  <span class="nx">deselectStory</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">selectedStory</span><span class="o">:</span> <span class="kc">null</span> <span class="p">})</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>At this point
we have made references to <code>App</code>’s state in <code>componentDidMount</code>, <code>render</code>,
<code>selectStory</code>, and <code>deselectStory</code>.
Flow checks all of those uses against the definition of <code>AppState</code>.
For example, if we made a mistaken assumption that <code>selectedStory</code> holds an ID,
as opposed to a value of type <code>Story</code>,
and tried to write something like <code>this.setState({ selectedStory: story.id })</code>,
Flow would report an error, and point out the mismatch.</p>

<p>I have not given the implementation of <code>StoryView</code>,
which is responsible for displaying comments on a story.
It happens that <code>StoryView</code> is quite similar to <code>App</code> -
except that <code>StoryView</code> loads comments where <code>App</code> loads stories.
The interested reader can see the full details of <code>StoryView</code> in the
<a href="https://github.com/hallettj/flow-cookbook-react/blob/master/src/StoryView.js">accompanying code</a>.</p>

<p>Complete working code is available at
<a href="https://github.com/hallettj/flow-cookbook-react">https://github.com/hallettj/flow-cookbook-react</a>.
Your next assignment is to clone that code and to add some features.
Some ideas to try are to add links to original stories,
or to display profile pages for posters and commenters.</p>

<p>The example code here uses React’s own state features to manage app state.
That helps to keep this recipe self-contained.
But in my opinion the best practice is to keep state in a third-party
state-management framework, such as <a href="http://redux.js.org/">Redux</a>.
For details on using Flow with Redux and <a href="http://redux.js.org/docs/basics/UsageWithReact.html">react-redux</a>,
take a look at the next recipe, <a href="/todo.html">Flow &amp; Redux</a>.</p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jesse Hallett</span></span>

      








  


<time datetime="2017-01-03T00:00:00-08:00" pubdate data-updated="true">2017-01-03</time>
      


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2016/12/20/flow-cookbook-unpacking-json.html" title="Previous Post: Flow Cookbook: Unpacking JSON API data">&laquo; Flow Cookbook: Unpacking JSON API data</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2017/01/03/flow-cookbook-react.html">Flow Cookbook: Flow & React</a>
      </li>
    
      <li class="post">
        <a href="/2016/12/20/flow-cookbook-unpacking-json.html">Flow Cookbook: Unpacking JSON API data</a>
      </li>
    
      <li class="post">
        <a href="/2016/12/20/flow-cookbook.html">Flow Cookbook</a>
      </li>
    
      <li class="post">
        <a href="/2015/05/31/type-checking-react-with-flow.html">Type checking React with Flow v0.11</a>
      </li>
    
      <li class="post">
        <a href="/2015/05/31/advanced-features-in-flow.html">Advanced features in Flow</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Talks</h1>
  <ul id="talks">
    <li><a href="http://opensourcebridge.org/sessions/1067">Mod your Android</a></li>
    <li><a href="talks/intro-to-javascript/">Introduction to JavaScript</a></li>
    <li><a href="http://lanyrd.com/2012/nodepdx/smyqm/">Object-oriented patterns in JavaScript</a></li>
    <li><a href="talks/cookies/">Cookies are bad for you</a></li>
    <li><a href="talks/professional-javascript/">Professional JavaScript</a></li>
    <li><a href="http://opensourcebridge.org/2009/wiki/Clustering_Data_--_How_to_Have_Fun_in_n-Dimensions">Cluster Analysis: How to Have Fun in n Dimensions</a></li>
    <li><a href="https://docs.google.com/presentation/d/1hx9Pzo07aAnZ2skMH4JPjH7a6IXx64uC0zRliS3qpkk/edit?usp=sharing">How to build blazing fast web apps with Ruby on Rails</a></li>
  </ul>
</section>
<section>
  <h1>Open Source Projects</h1>
  <ul id="projects">
    <li><a href="http://github.com/jivesoftware/tAMD">tAMD:</a> Tiny, extensible implementation of the Asynchronous Module Definition (AMD) specification from CommonJS</li>
  </ul>
</section>
<section>
  <div class="contact" style="float:left; margin:0.5em;">
    <p>
      Jesse Hallett<br/>
      <a href="mailto:jesse@sitr.us">jesse@sitr.us</a>
    </p>
  </div>
  <div class="contact" style="float:left; margin:0.5em;">
    <p>
      <a rel="me" href="https://github.com/hallettj/">github.com/hallettj</a><br />
      <a rel="me" href="https://twitter.com/hallettj/">twitter.com/hallettj</a>
    </p>
  </div>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Jesse Hallett -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'hallettj';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://sitr.us/2017/01/03/flow-cookbook-react.html';
        var disqus_url = 'http://sitr.us/2017/01/03/flow-cookbook-react.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
