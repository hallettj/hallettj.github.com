
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>sitr.us</title>
  <meta name="author" content="Jesse Hallett">

  
  <meta name="description" content="I now have a Kinesis Advantage keyboard for use at work.
I have been feeling some wrist strain recently;
and some of my coworkers were encouraging &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- OpenID delegation -->
  <link rel="openid2.provider" href="https://www.google.com/accounts/o8/ud">
  <link rel="openid2.local_id" href="https://profiles.google.com/103016652009176760588">

  
  <link rel="canonical" href="http://sitr.us/index.html">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/hallettj" rel="alternate" title="sitr.us" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-327628-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">sitr.us</a></h1>
  
    <h2>posts by Jesse Hallett</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/hallettj" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sitr.us" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/05/19/kinesis-advantage-with-dsa-keycaps.html">Kinesis Advantage with DSA keycaps</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-19T00:00:00-07:00" pubdate data-updated="true">2014-05-19</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://lh4.googleusercontent.com/MPfjOyaNmMKZRL36XEekqRiaeoHcUFLQLN-Kx62XKbgN=w1024-h576-no" /></p>

<p>I now have a Kinesis Advantage keyboard for use at work.
I have been feeling some wrist strain recently;
and some of my coworkers were encouraging me to try one.
So I borrowed a Kinesis for a week, and found that I really liked it.
The contoured shape makes reaching for keys comfortable;
I find the column layout to be nicer than the usual staggered key arrangement;
and between the thumb-key clusters and the arrow keys,
there are a lot of options for mapping modifier keys that are in easy reach.</p>

<p><span class="caption-wrapper"><img class="caption" src="/images/kinesis-dsa/IMG_20140515_175553491_HDR.jpg" width="" height="" title="Kinesis Advantage, before modification" /><span class="caption-text">Kinesis Advantage, before modification</span></span></p>

<p>But I really like the PBT keycaps on my <a href="http://imgur.com/a/XZ2hG">Leopold</a>.
I would not enjoy going back to plain, old ABS.
I also don’t want my keyboard to be just like every other Kinesis.
So I decided to get replacement keycaps.</p>

<p>I did some research on buying PBT keycaps with the same profiles as the stock Kinesis keys.
I assumed that I would end up getting blank keycaps -
putting together a set with legends appropriate for a Kinesis seemed like it would be a painful undertaking,
since there don’t seem to be any sets made specifically for the Kinesis.</p>

<p>Most keyboards - including the Kinesis Advantage - use what is called a DCS profile,
where the keys in each row have different heights and angles.
(That does not include laptop keyboards,
or island-style keyboards such as the ones that Apple sells.
Those are in their own categories.)
<span class="caption-wrapper left"><img class="caption" src="/images/kinesis-dsa/angle3.jpg" width="" height="" title="DCS family: medium profile, cylindrical top, sculptured. &lt;br&gt; Image from Signature Plastics." /><span class="caption-text">DCS family: medium profile, cylindrical top, sculptured. <br /> Image from Signature Plastics.</span></span>
Input Nirvana on Geekhack has a post with <a href="http://geekhack.org/index.php?topic=29875.0">a list of all necessary keycap sizes and profiles</a>
to reproduce the arrangement on a stock Kinesis.
It is possible to order these individually from Signature Plastics;
but their inventory for <em>à la carte</em> orders varies depending on what they have left over
from production of large batches.
When I checked, SP did not have any row 5 PBT keycaps available.
I got the impression that building a custom DCS set would be somewhat difficult.</p>

<p>Then I saw prdlm2009 on Deskthority suggest that <a href="http://deskthority.net/photos-videos-f8/kinesis-advantage-with-spherical-keycaps-dsa-family-for-sp-t4842.html">DSA profile keycaps work well on a Kinesis</a>.
DSA is a uniform profile -
every key has the same height and angle.
It makes everything much simpler when dealing with unusual keyboard layouts,
or unusual keyboards.
<span class="caption-wrapper right"><img class="caption" src="/images/kinesis-dsa/angle2.jpg" width="" height="" title="DSA family medium profile, spherical top, non-sculptured. &lt;br&gt; Image from Signature Plastics." /><span class="caption-text">DSA family medium profile, spherical top, non-sculptured. <br /> Image from Signature Plastics.</span></span>
DSA also features spherical tops.
If you look at the keys on a typical keyboard, you can see that the top curves up on the left and right sides -
as though someone had shaped them around a cylinder.
The tops of DSA keys are spherical; as though shaped around a large marble.
So the keys cup the fingertips from all sides.</p>

<p>Signature Plastics sells a variety of nice, blank DSA keycap sets.
I did not order the optimal combination of keycap sets;
but now I have a better idea of what that combination is.
The key count on an Advantage is:</p>

<ul>
  <li>56 – 1x keys (optionally including two homing keys)</li>
  <li>8 – 1.25x keys</li>
  <li>4 – 2x keys</li>
</ul>

<p>1x, 2x, etc. refers to the lengths of the keys.</p>

<p>One can get everything except the 1.25x keys with one <a href="http://keyshop.pimpmykeyboard.com/products/full-keysets/dsa-blank-numpad-sets-1">ErgoDox Base set</a>
and two <a href="http://keyshop.pimpmykeyboard.com/products/full-keysets/dsa-blank-numpad-sets">Numpad sets</a>.
The Numpad sets seem to be the cheapest way to get all 4 2x keycaps, along with additional 1x caps.
The only set that includes 1.25x caps is the Standard Modifier set,
which includes 7 of them.
(So close!)
I recommend ordering the 1.25x keycaps individually from the <a href="http://www.keycapsdirect.com/key-capsinventory.php">blank keycap inventory</a>.</p>

<p><span class="caption-wrapper"><img class="caption" src="/images/kinesis-dsa/IMG_20140515_180022543_HDR.jpg" width="" height="" title="stock Kinesis keycaps (left), DSA keycaps (right)" /><span class="caption-text">stock Kinesis keycaps (left), DSA keycaps (right)</span></span></p>

<p>The keycaps from SP are much thicker than the stock keycaps.
And they are made from PBT plastic, which is denser than the more common keycap material, ABS.
What I like most about PBT caps is their texture.
The tops of the keys are usually slightly rough, somewhat pebbly.
It gives a little bit of grippiness,
and feels soothing on my fingers compared to featureless, flat plastic.
I also think that the sound of PBT keys being pressed is nicer.
It is slightly quieter, with a somewhat deeper tone.</p>

<p><span class="caption-wrapper"><img class="caption" src="/images/kinesis-dsa/IMG_20140515_182527431_HDR.jpg" width="" height="" title="All of the stock keycaps have been removed, revealing Cherry MX Brown switches." /><span class="caption-text">All of the stock keycaps have been removed, revealing Cherry MX Brown switches.</span></span></p>

<p>The Kinesis Advantage comes with either <a href="http://deskthority.net/wiki/Cherry_MX_Brown">Cherry MX Brown</a> or <a href="http://deskthority.net/wiki/Cherry_MX_Red">Cherry MX Red</a> switches.</p>

<p>For anyone wondering how to remove keycaps from a keyboard with Cherry MX switches, here is a <a href="https://www.youtube.com/watch?v=FlUYCAZNNOw">video</a>.
What the video does not mention is that it is a good idea to wiggle the keycap puller while pulling up on the keycap.
That helps to avoid pulling with too much force, which could break a switch.</p>

<p>I have another keyboard that also has Cherry MX Brown switches,
and I really liked the change in key feel after installing o-rings.
O-rings make typing a little quieter,
and add some springiness to the bottom of the key travel.
A tradeoff is that they reduce the length of key travel a bit.</p>

<p><span class="caption-wrapper"><img class="caption" src="/images/kinesis-dsa/IMG_20140515_182759811.jpg" width="" height="" title="installing o-rings in the new keycaps" /><span class="caption-text">installing o-rings in the new keycaps</span></span></p>

<p>I used <a href="http://www.wasdkeyboards.com/index.php/cherry-mx-rubber-o-ring-switch-dampeners-125pcs.html#ad-image-0">40A-R o-rings from WASD</a>, which are relatively thick and soft.
But when I tried these out with the DSA keycaps I could not discern any difference
between a key with an o-ring and one without.</p>

<p>Comparing the underside of a DSA keycap to a typical DCS keycap reveals the issue:</p>

<p><span class="caption-wrapper"><img class="caption" src="/images/kinesis-dsa/IMG_20140515_180233205.jpg" width="" height="" title="blank DSA keycaps from SP (top), keycaps from a Leopold FC660M (bottom)" /><span class="caption-text">blank DSA keycaps from SP (top), keycaps from a Leopold FC660M (bottom)</span></span></p>

<p>DCS keycaps have cross-shaped supports under the cap,
which contact the top of the switch housing when the key is fully depressed.
O-rings sit between those supports and the switch housing,
absorbing some force from contact.
But the DSA keycaps lack those supports.
That means that the switch can reach the bottom of its travel
before the underside of the keycap contacts the switch housing.</p>

<p>I found that doubling up o-rings pushed the rubber high enough to be effective.
But I was concerned that two o-rings shorted key travel too much
and introduced too much squishiness.
In the end I left the o-rings out entirely.
I may take another shot using either thinner, firmer o-rings,
or with small washers in place of a second o-ring.</p>

<p><span class="caption-wrapper"><img class="caption" src="/images/kinesis-dsa/IMG_20140515_183902311.jpg" width="" height="" title="two o-rings installed in one keycap" /><span class="caption-text">two o-rings installed in one keycap</span></span></p>

<p>When I ordered my keycaps I got one ErgoDox Base set and one ErgoDox Modifier set.
I did not do enough checking - I assumed that the 1.5x keys in the Modifier set
would fit in the Kinesis.
But it turns out that the keys in the leftmost and rightmost columns of the Kinesis
take 1.25x keycaps.
The larger keycaps do not fit.</p>

<p><span class="caption-wrapper"><img class="caption" src="/images/kinesis-dsa/IMG_20140515_190504044_HDR.jpg" width="" height="" title="Whoops!  That was supposed to be a 1.25x key, not a 1.5x." /><span class="caption-text">Whoops!  That was supposed to be a 1.25x key, not a 1.5x.</span></span></p>

<p>I have ordered some appropriately sized keycaps.
In the meantime, I am using 1x keycaps in the 1.25x positions.</p>

<p><span class="caption-wrapper"><img class="caption" src="/images/kinesis-dsa/IMG_20140515_190751151_HDR.jpg" width="" height="" title="stock 1.25x Tab key next to its intended, blank replacement" /><span class="caption-text">stock 1.25x Tab key next to its intended, blank replacement</span></span></p>

<p>Even though the DSA keycaps are not the same shape as the stock caps,
they fit quite well on the Kinesis.
There are just two slightly problematic spots.
The photo below shows the one key that comes into contact with the edge of the keyboard case when it is not depressed.
Thankfully the operation of the key does not seem to be affected.</p>

<p><span class="caption-wrapper"><img class="caption" src="/images/kinesis-dsa/IMG_20140515_190931944.jpg" width="" height="" title="The fit is tight in this corner." /><span class="caption-text">The fit is tight in this corner.</span></span></p>

<p>Due to small differences in switch positioning,
the key in the same position in the other well has a little bit of clearance.</p>

<p>The other problem is that two of my 2x keys overlap very slightly.
When I press the one on the right there is sometimes an extra <em>click</em>
as it pushes past its neighbor.</p>

<p><span class="caption-wrapper"><img class="caption" src="/images/kinesis-dsa/IMG_20140515_194515105.jpg" width="" height="" title="There is not quite enough space between these two keys." /><span class="caption-text">There is not quite enough space between these two keys.</span></span></p>

<p>I am thinking of sanding down the corners of these keys a little bit to fix the problem.</p>

<p>This is another case where there is no problem with the keys in the same positions on the other side of the board.
It seems that the switches in the left thumb cluster just happen to be
a little too close together on my board.</p>

<p><span class="caption-wrapper"><img class="caption" src="/images/kinesis-dsa/IMG_20140515_194232464_HDR.jpg" width="" height="" title="All done!" /><span class="caption-text">All done!</span></span></p>

<p>Since I had to use 1u keycaps for the leftmost and rightmost columns,
I ended up not having enough keycaps to replace the two keycaps in the top of each thumb cluster.
But I think that having tall keycaps there makes them easier to press -
those positions are a bit difficult to reach otherwise.
So I may just keep the stock caps on those keys.
Or I might try to get tall, DCS profile, PBT caps for those positions.</p>

<p><span class="caption-wrapper"><img class="caption" src="/images/kinesis-dsa/IMG_20140515_194415103_HDR.jpg" width="" height="" title="closeup of one of the wells to show key spacing" /><span class="caption-text">closeup of one of the wells to show key spacing</span></span></p>

<p>The other positions where I think that DSA does not work really well are the four keys in the bottom row of each well.
I curl my fingers down to reach those;
and I tend to either hit the edges of the keys,
or to press them with my fingernail instead of with my finger.
The stock keycaps for those positions are angled toward the center of the well,
making it easier to reach the tops of the keys.</p>

<p>Those points aside,
I am very pleased with how these new keycaps worked out!
The DSA profile is quite comfortable.
I love the texture of the PBT keycaps.
And they make a more pleasant sound than the thinner ABS caps that came with the board.</p>

<p><span class="caption-wrapper"><img class="caption" src="/images/kinesis-dsa/IMG_20140518_185154.jpg" width="" height="" title="shoe for science!" /><span class="caption-text">shoe for science!</span></span></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/05/05/category-theory-proofs-in-idris.html">Category Theory proofs in Idris</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-05T00:00:00-07:00" pubdate data-updated="true">2014-05-05</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.idris-lang.org/">Idris</a> is a programming language with dependent types.
It is similar to <a href="http://wiki.portal.chalmers.se/agda/pmwiki.php">Agda</a>, but hews more closely to <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>.
The goal of Idris is to bring dependent types to general-purpose programming.
It supports multiple compilation targets, including C and Javascript.</p>

<p>Dependent types provide an unprecedented level of type safety.
A quick example is a <a href="https://www.youtube.com/watch?v=fVBck2Zngjo">type-safe printf implementation (video)</a>.
They are also useful for theorem proving.
According to the <a href="http://en.wikipedia.org/wiki/Curry–Howard_correspondence">Curry-Howard correspondence</a>,
mathematical propositions can be represented in a program as types.
An implementation that satisfies a given type
serves as a proof of the corresponding proposition.
In other words, inhabited types represent true propositions.</p>

<p>The Curry-Howard correspondence applies to every language with type checking.
But the type systems in most languages are not expressive enough
to build very interesting propositions.
On the other hand,
dependent types can express quantification
(i.e., the mathematical concepts of universal quantification (∀) and existential quantification (∃)).
This makes it possible to translate a lot of interesting math into machine-verified code.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/2014/05/05/category-theory-proofs-in-idris.html">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/11/04/functional-data-structures.html">Functional data structures in JavaScript with Mori</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-04T00:00:00-08:00" pubdate data-updated="true">2013-11-04</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have a long-standing desire for a JavaScript library that provides
good implementations of functional data structures.  Recently I found
<a href="http://swannodette.github.io/mori/">Mori</a>, and I think that it may be just the library that I have been
looking for.  Mori packages data structures from the <a href="http://clojure.org/">Clojure</a>
standard library for use in JavaScript code.</p>

<ul id="markdown-toc">
  <li><a href="#functional-data-structures">Functional data structures</a></li>
  <li><a href="#clojure-clojurescript-and-mori">Clojure, ClojureScript, and Mori</a></li>
  <li><a href="#installing-and-running">Installing and running</a></li>
  <li><a href="#examples">Examples</a>    <ul>
      <li><a href="#vector"><code>vector</code></a></li>
      <li><a href="#higher-order-functions">higher-order functions</a></li>
      <li><a href="#sortedsetby"><code>sorted_set_by</code></a></li>
      <li><a href="#hashmap"><code>hash_map</code></a></li>
    </ul>
  </li>
  <li><a href="#apples-to-apples">Apples to apples</a></li>
  <li><a href="#mori-pairs-well-with-bacon">Mori pairs well with Bacon</a></li>
  <li><a href="#list-versus-vector">List versus Vector</a></li>
  <li><a href="#equality-ordering-and-hashing">Equality, ordering, and hashing</a>    <ul>
      <li><a href="#hash">hash</a></li>
      <li><a href="#equals">equals</a></li>
      <li><a href="#compare">compare</a></li>
    </ul>
  </li>
  <li><a href="#different-map-and-set-implementations">Different map and set implementations</a></li>
  <li><a href="#laziness">Laziness</a>    <ul>
      <li><a href="#efficiency">Efficiency</a></li>
    </ul>
  </li>
</ul>

<h2 id="functional-data-structures">Functional data structures</h2>

<p>A functional data structure (also called a persistent data structure)
has two important qualities: it is immutable and it can be updated by
creating a copy with modifications (copy-on-write).  Creating copies
should be nearly as cheap as modifying a comparable mutable data
structure in place.  This is achieved with structural sharing: pointers
to unchanged portions of a structure are shared between copies so that
memory need only be allocated for changed portions of the data
structure.</p>

<p>A simple example is a <a href="https://en.wikipedia.org/wiki/Linked_list">linked list</a>.  A linked list is an object,
specifically a list node, with a value and a pointer to the next list
node, which points to the next list node.  (Eventually you get to the
end of the list where there is a node that points to the empty list.)
Prepending an element to the front of such a list is a constant-time
operation: you just create a new list element with a pointer to the
start of the existing list.  When lists are immutable there is no need
to actually copy the original list.  Removing an element from the front
of a list is also a constant-time operation: you just return a pointer
to the second element of the list.  Here is <a href="http://anorwell.com/index.php?id=61">a slightly more-detailed
explanation</a>.</p>

<p>Lists are just one example.  There are functional implementations of
maps, sets, and other types of structures.</p>

<p>Rich Hickey, the creator Clojure, describes functional data structures
as <a href="http://clojure.org/state">decoupling state and time</a>.  (Also available in
<a href="http://www.infoq.com/presentations/Are-We-There-Yet-Rich-Hickey">video form</a>.)  The idea is that code that uses
functional data structures is easier to reason about and to verify than
code that uses mutable data structures.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/2013/11/04/functional-data-structures.html">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/05/22/functional-reactive-programming-in-javascript.html">Functional Reactive Programming in JavaScript</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-22T00:00:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I had a great time at <a href="http://nodepdx.org/">NodePDX</a> last week.  There were many talks
packed into a short span of time and I saw many exciting ideas
presented.  One topic that seemed particularly useful to me was <a href="http://lanyrd.com/2013/nodepdx/schbpc/">Chris
Meiklejohn’s talk on Functional Reactive Programming (FRP)</a>.</p>

<p>I have talked and written about how useful promises are.  See <a href="http://sitr.us/2012/07/31/promise-pipelines-in-javascript.html">Promise
Pipelines in JavaScript</a>.  Promises are useful when you want
to represent the outcome of an action or a value that will be available
at some future time.  FRP is similar except that it deals with streams
of reoccurring events and dynamic values.</p>

<p>Here is an example of using FRP to subscribe to changes to a text input.
This creates an event stream that could be used for a typeahead search
feature:</p>

<div class="highlight"><pre><code class="js"><span class="kd">var</span> <span class="nx">inputs</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#search&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">asEventStream</span><span class="p">(</span><span class="s1">&#39;keyup change&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">;</span> <span class="p">});</span>

<span class="kd">var</span> <span class="nx">throttled</span> <span class="o">=</span> <span class="nx">inputs</span><span class="p">.</span><span class="nx">throttle</span><span class="p">(</span><span class="mi">500</span> <span class="cm">/* ms */</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">distinct</span> <span class="o">=</span> <span class="nx">throttled</span><span class="p">.</span><span class="nx">skipDuplicates</span><span class="p">();</span>
</code></pre></div>

<p>This creates an event stream from all <code>keyup</code> and <code>change</code> events on the
given input.  The stream is transformed into a stream of strings matching
the value of the input when each event occurs.  Then that stream is
filtered so that subscribers to <code>inputs</code> will only receive events if the
value of the input has a length greater than two.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/2013/05/22/functional-reactive-programming-in-javascript.html">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/09/04/monkey-patching-document-write.html">Monkey patching document.write()</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-04T00:00:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is one of the crazier workarounds that I have implemented.  I was
working on a web page that embeds third-party widgets.  The widgets are
drawn in the page document - they do not get their own frames.  And
sometimes the widgets are redrawn after page load.</p>

<p>We had a problem with one widget invoking <code>document.write()</code>.  In case
you are not familiar with it, if that method is called while the page is
rendering it inserts content into the DOM immediately after the script
tag in which the call is made.  But if <code>document.write()</code> is called
after page rendering is complete it erases the entire DOM.  When this
widget was redrawn after page load it would kill the whole page.</p>

<p>The workaround we went with was to disable <code>document.write()</code> after page
load by replacing it with a wrapper that checks whether the jQuery ready
event has fired.</p>

<div class="highlight"><pre><code class="js"><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">originalWrite</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">write</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">jQuery</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">isReady</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">console</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;document.write called after page load&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// In IE before version 8 `document.write()` does not</span>
            <span class="c1">// implement Function methods, like `apply()`.</span>
            <span class="k">return</span> <span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">apply</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
                <span class="nx">originalWrite</span><span class="p">,</span> <span class="nb">document</span><span class="p">,</span> <span class="nx">arguments</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">})();</span>
</code></pre></div>

<p>The new implementation checks the value of <code>jQuery.isReady</code> and
delegates to the original <code>document.write()</code> implementation if the page
is not finished rendering yet.  Otherwise it does nothing other than to
output a warning message.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/2012/09/04/monkey-patching-document-write.html">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/07/31/promise-pipelines-in-javascript.html">Promise Pipelines in JavaScript</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-31T00:00:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><aside class="translations"><p>This page has been translated into <a href="http://www.webhostinghub.com/support/es/misc/las-bases-de">Spanish</a>
language by Maria Ramos  from <a href="http://www.webhostinghub.com/">Webhostinghub.com</a>.</p></aside>

<p>Promises, also know as deferreds or futures, are a wonderful abstraction
for manipulating asynchronous actions.  Dojo has had <a href="http://dojotoolkit.org/reference-guide/1.7/dojo/Deferred.html">Deferreds</a>
for some time.  jQuery introduced <a href="http://api.jquery.com/category/deferred-object/">its own Deferreds</a>
in version 1.5 based on the CommonJS <a href="http://wiki.commonjs.org/wiki/Promises/A">Promises/A</a> specification.  I’m
going to show you some recipes for working with jQuery Deferreds.  Use
these techniques to turn callback-based spaghetti code into elegant
declarative code.</p>

<h2 id="the-basics-of-jquery-deferreds">The basics of jQuery Deferreds</h2>

<p>A Deferred is an object that represents some future outcome.  Eventually
it will either resolve with one or more values if that outcome was
successful; or it will fail with one or more values if the outcome was
not successful.  You can get at those resolved or failed values by
adding callbacks to the Deferred.</p>

<p>In jQuery’s terms a promise is a read-only view of a deferred.</p>

<p>Here is a simple example of creating and then resolving a promise:</p>

<div class="highlight"><pre><code class="js"><span class="kd">function</span> <span class="nx">fooPromise</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>

    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">);</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<p>Callbacks can be added to a deferred or a promise using the <code>.then()</code>
method.  The first callback is called on success, the second on failure:</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/2012/07/31/promise-pipelines-in-javascript.html">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/05/12/installing-a-custom-rom-on-the-transformer-prime.html">Installing a custom ROM on the Transformer Prime: A start-to-finish guide</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-12T00:00:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This guide provides step-by-step instructions for installing the <a href="http://www.virtuousrom.com/p/prime.html">Virtuous Prime</a>
community ROM on your Asus Transformer Prime TF201 tablet.  This guide will
be useful to you if you do not have root access to your tablet.</p>

<p>Be aware that following the instructions here will void your warranty and
will wipe all of the data on your tablet.  There is also a danger that you
might brick your tablet.  Proceed at your own risk.</p>

<p>So, why would you want to install a custom ROM on your tablet?  In my case
I wanted to gain root access, which allows one to do all sorts of nifty
things.  Community-made ROMS are also often customized to make the Android
experience more pleasant for power users.  And choosing your own ROM means
that you are no longer dependent on the company that sold you your device
to distribute firmware updates in a timely fashion.  But if you are reading
this then you probably already know why you want to install a custom ROM
- so let’s get on to the next step.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/2012/05/12/installing-a-custom-rom-on-the-transformer-prime.html">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/08/26/cookies-are-bad-for-you.html">Cookies are bad for you: Improving web application security</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-26T00:00:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Most web applications today use browser cookies to keep a user logged in
while she is using the application.  Cookies are a decades-old device
and they do not stand up well to security threats that have emerged on
the modern web.  In particular, cookies are vulnerable to <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">cross-site
request forgery</a>.  Web applications can by made more secure by
using <a href="http://oauth.net/">OAuth</a> for session authentication.</p>

<p>This post is based on <a href="http://opensourcebridge.org/sessions/663">a talk that I gave</a> at <a href="http://opensourcebridge.org/">Open Source
Bridge</a> this year.  The slides for that talk are available
<a href="/talks/cookies/">here</a>.</p>

<p><img alt="cookie authentication" src="/talks/cookies/svg/cookies.svg" style="width: 100%" /></p>

<p>When a user logs into a web application the application server sets
a cookie value that is picked up by the user’s browser.  The browser
includes the same cookie value in every request sent to the same host
until the cookie expires.  When the application server receives
a request it can check whether the cookies attached to it contain
a value that identifies a specific user.  If such a cookie value exists
then the server can consider the request to be authenticated.</p>

<p><img alt="attacks that target browser authentication" src="/talks/cookies/svg/cookie-strengths.svg" style="width: 100%" /></p>

<p>There are many types of attacks that can be performed against a web
application.  Three that specifically target authentication between the
browser and the server are <a href="http://en.wikipedia.org/wiki/Man-in-the-middle_attack">man-in-the-middle (<abbr title="man-in-the-middle">MITM</abbr>)</a>, <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">cross-site
request forgery (<abbr title="cross-site request forgery">CSRF</abbr>)</a>, and <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">cross-site scripting (<abbr title="cross-site scripting">XSS</abbr>)</a>.
Plain cookie authentication is vulnerable to all three.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/2011/08/26/cookies-are-bad-for-you.html">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/07/28/how-mobile-safari-emulates-mouse-events.html">How Mobile Safari emulates mouse events</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-28T00:00:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When you are adapting web apps to touchscreen devices particular
challenges come up around events like <code>mouseover</code> and <code>mouseout</code>.
Touchscreen devices like the iPad do not have a cursor, so the user
cannot exactly move the mouse over an HTML element.  However, Mobile
Safari, the web browser that comes with the iPhone and iPad, has
a fallback for websites that require hovering or cursor movement.</p>

<p>Usually when you tap on an element on a link or other clickable element
Mobile Safari translates that into a regular <code>click</code> event.  The browser
also produces some touch events that do not exist in a lot of browsers.
But from the perspective of a web page that was not designed with
a touchscreen in mind, what you get is a plain <code>click</code>.  More
specifically, the browser fires <code>mousedown</code>, <code>mouseup</code>, and <code>click</code> in
that order.  But if a clickable element also does something on
<code>mouseover</code> then tapping on that element will trigger a <code>mouseover</code> event
instead of a <code>click</code>.  Tapping on the same element again will produce
a <code>click</code> event.  A random example of a page that exhibits this behavior
is <a href="http://opensourcebridge.org/events/2011/schedule">the schedule page</a> from the <a href="http://opensourcebridge.org/">Open Source Bridge</a>
website.  Try tapping on session titles and see what happens.</p>

<p>Mobile Safari will only produce mouse events when the user taps on
a clickable element, like a link.  You can make an element clickable by
adding an onClick event handler to it, even if that handler does
nothing.  On tap Mobile Safari fires the events <code>mouseover</code>,
<code>mousemove</code>, <code>mousedown</code>, <code>mouseup</code>, and <code>click</code> in that order - with
some caveats which are explained below.  Those events all fire together
after the user lifts her finger.  You might expect the <code>mousedown</code> event
to fire as soon as the user presses her finger to the screen - but it
does not.  When the user taps on another clickable element the browser
fires a <code>mouseout</code> event on the first element in addition to firing the
aforementioned events on the new element.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/2011/07/28/how-mobile-safari-emulates-mouse-events.html">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/09/13/couchdb-notes.html">CouchDB Notes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-13T00:00:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I gave a talk at <a href="http://pdxruby.org/" title="Portland Ruby Brigade">Portland Ruby Brigade</a> meeting on
<a href="http://couchdb.apache.org/" title="CouchDB">CouchDB</a>, a document-oriented database.  I thought I would share my notes
from that talk.  In some respects this was a followup to <a href="http://groups.google.com/group/pdxruby/browse_thread/thread/6f8734846d3e16d3" title="Comparing MongoDB, Tokyo Tyrant, and CouchDB">an earlier talk that
Igal Koshevoy gave comparing various post-relational databases</a>.
Igal also wrote <a href="http://groups.google.com/group/pdxruby/browse_thread/thread/7865318fbc65d0d1" title="Ruby Persistence with CouchDB">some additional notes on my talk</a>.</p>

<p>In summary, some of the distinguishing features of CouchDB are:</p>

<ul>
  <li>Schema-less data store stores documents containing arbitrary JSON data.</li>
  <li>Incrementally updated map-reduce views provide fast access to data, support powerful data processing, and eliminate lookup penalties for data in large or deeply nested documents.</li>
  <li>Map-reduce views - which are again, incrementally updated - provide fast access to aggregate data, such as sums or averages of document attributes.</li>
  <li>Schema-less design means no schema migrations are ever required.  And new map-reduce views can be installed with no downtime.</li>
  <li>“Crash-only” design protects data integrity in almost every crash scenario.  No recovery process is required when rebooting a crashed database server.</li>
  <li>Lock-free design means that read requests never have to wait for other read or write requests to finish.  Writes are only serialized at the point where data is actually written to the disk.</li>
  <li>Integrated, robust master-master replication with automatic conflict handling</li>
  <li>MVCC, or “optimistic locking”, prevents data loss from multiple writes to the same document from different sources.</li>
  <li>RESTful interface makes it easy to integrate CouchDB with any environment that speaks HTTP.</li>
  <li>Documents can contain binary attachments.  Attachment support combined with the HTTP interface means that CouchDB can serve HTML, JavaScript, images, and anything else required to host a web application directly from the database.</li>
</ul>

<p>More detailed information on all of the above points can be found in <a href="http://couchdb.apache.org/docs/overview.html" title="CouchDB Technical Overview">CouchDB’s
technical overview</a>.</p>

<p>Some of the downsides:</p>

<ul>
  <li>Writes and single-document lookups are slower than other databases due to HTTP overhead and frequent disk access.</li>
  <li>CouchDB optimizes CPU and RAM use by using lots of disk space.  The same data set will take up a lot more space in CouchDB than in other database systems.</li>
  <li>You must create map-reduce views in advance for any queries you want to run.  SQL users are used to processing data at query time; but this is not allowed by the CouchDB design (assuming you are not using temporary views in production, which you should not do.)</li>
  <li>There is a serious learning curve when learning to think in terms of map-reduce views.</li>
  <li>Map-reduce views, though very powerful, are not as flexible as SQL queries.  There may be cases where it is necessary to push data processing to an asynchronous job or to the client.</li>
  <li>CouchDB is a young project and its API is undergoing rapid changes.</li>
  <li>Documentation can be sparse - especially when very new features are involved.  </li>
</ul>

</div>
  
  
    <footer>
      <a rel="full-article" href="/2009/09/13/couchdb-notes.html">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014/05/19/kinesis-advantage-with-dsa-keycaps.html">Kinesis Advantage with DSA keycaps</a>
      </li>
    
      <li class="post">
        <a href="/2014/05/05/category-theory-proofs-in-idris.html">Category Theory proofs in Idris</a>
      </li>
    
      <li class="post">
        <a href="/2013/11/04/functional-data-structures.html">Functional data structures in JavaScript with Mori</a>
      </li>
    
      <li class="post">
        <a href="/2013/05/22/functional-reactive-programming-in-javascript.html">Functional Reactive Programming in JavaScript</a>
      </li>
    
      <li class="post">
        <a href="/2012/09/04/monkey-patching-document-write.html">Monkey patching document.write()</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Talks</h1>
  <ul id="talks">
    <li><a href="http://opensourcebridge.org/sessions/1067">Mod your Android</a></li>
    <li><a href="talks/intro-to-javascript/">Introduction to JavaScript</a></li>
    <li><a href="http://lanyrd.com/2012/nodepdx/smyqm/">Object-oriented patterns in JavaScript</a></li>
    <li><a href="talks/cookies/">Cookies are bad for you</a></li>
    <li><a href="talks/professional-javascript/">Professional JavaScript</a></li>
    <li><a href="http://opensourcebridge.org/2009/wiki/Clustering_Data_--_How_to_Have_Fun_in_n-Dimensions">Cluster Analysis: How to Have Fun in n Dimensions</a></li>
    <li><a href="https://docs.google.com/presentation/d/1hx9Pzo07aAnZ2skMH4JPjH7a6IXx64uC0zRliS3qpkk/edit?usp=sharing">How to build blazing fast web apps with Ruby on Rails</a></li>
  </ul>
</section>
<section>
  <h1>Open Source Projects</h1>
  <ul id="projects">
    <li><a href="http://github.com/jivesoftware/tAMD">tAMD:</a> Tiny, extensible implementation of the Asynchronous Module Definition (AMD) specification from CommonJS</li>
  </ul>
</section>
<section>
  <div class="contact" style="float:left; margin:0.5em;">
    <p>
      Jesse Hallett<br/>
      <a href="mailto:jesse@sitr.us">jesse@sitr.us</a>
    </p>
  </div>
  <div class="contact" style="float:left; margin:0.5em;">
    <p>
      <a rel="me" href="https://github.com/hallettj/">github.com/hallettj</a><br />
      <a rel="me" href="https://twitter.com/hallettj/">twitter.com/hallettj</a>
    </p>
  </div>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Jesse Hallett -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'hallettj';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
